#
# Copyright (c) 2014-2018 Chris Dragan
#
# Permission is hereby granted, free of charge, to any person obtaining a copy
# of this software and associated documentation files (the "Software"), to
# deal in the Software without restriction, including without limitation the
# rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
# sell copies of the Software, and to permit persons to whom the Software is
# furnished to do so, subject to the following conditions:
#
# The above copyright notice and this permission notice shall be included in
# all copies or substantial portions of the Software.
#
# THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
# IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
# FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
# AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
# LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
# FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
# IN THE SOFTWARE.
#
import lang.range

fun expect_fail(function)
{
    var failed = false
    try {
        function()
    }
    catch const e {
        failed = true
    }
    assert failed
}

do {
    var a, b, c = "xyz1234"
    assert a == "x"
    assert b == "y"
    assert c == "z"
}

do {
    var a, b, c = [ 1, 5, 7, 10, 9 ]
    assert a == 1
    assert b == 5
    assert c == 7
}

do {
    var a, b, c = range(100)
    assert a == 0
    assert b == 1
    assert c == 2
}

expect_fail(fun {
    var a, b, c = "xy"
})

var global = void
do {
    const obj   = {}
    const array = [void, void]
    var   val   = void

    obj.x, array[0], val, global, array[1] = range(5)

    assert obj.x    == 0
    assert array[0] == 1
    assert val      == 2
    assert global   == 3
    assert array[1] == 4

    global, val, obj.x = "MNO"

    assert obj.x    == "O"
    assert array[0] == 1
    assert val      == "N"
    assert global   == "M"
    assert array[1] == 4

    array[:], val = [ "abcd", "e" ]

    assert array.size == 4
    assert array[0]   == "a"
    assert array[-1]  == "d"
    assert val        == "e"

    global, array[1:3] = "XY"

    assert global     == "X"
    assert array.size == 3
    assert array[0]   == "a"
    assert array[1]   == "Y"
    assert array[2]   == "d"

    expect_fail(fun {
        val, global, obj["y"], array[0] = range(3)
    })

    assert val      == 0
    assert global   == 1
    assert obj.y    == 2
    assert array[0] == "a"
}

do {
    var count = 0
    for var x, y, z = range(3); x < y; x += 1 {
        assert x == 0
        assert y == 1
        assert z == 2
        count += 1
    }
    assert count == 1
}

do {
    var a = [void, void, void]
    var i = 10

    i, a[i], a[i+1] = [1, 8, i]

    assert i    == 1
    assert a[0] == void
    assert a[1] == 8
    assert a[2] == 10
}

do {
    var count = 0
    for var x, y, z in [ [1, 2, 3, 10], [4, 5, 6] ] {
        if count == 0 {
            assert x == 1
            assert y == 2
            assert z == 3
        }
        else {
            assert x == 4
            assert y == 5
            assert z == 6
        }
        count += 1
    }
    assert count == 2
}

do {
    var failed = true
    try {
        for var x, y, z in [ [1, 2, 3], [3, 4] ] {
            if x != 1 {
                throw x
            }
        }
    }
    catch const e {
        assert typeof e.value != "integer"
        failed = false
    }
    assert ! failed
}
