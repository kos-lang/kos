class {
}

class {
    fun cat {
        return 0
    }

    fun dog() {
        return 1
    }

    fun pet(name) {
        return name ++ "x"
    }

    fun parrot(num_wings, color) {
        return num_wings + color
    }
}

class {
    fun aaa { }

    constructor { this.x = 0 }

    fun bbb { }
}

@ 0

(scope 1 1
    (class 1 1 class
        (empty 1 7 {)
        (object 1 7 {)
        (constructor 1 1 class
            (name 1 1 class)
            (parameters 1 7 {)
            (landmark 1 7 {)
            (scope 1 7 {
                (return 1 7 {
                    (this 1 7 {)
                )
            )
            (landmark 1 7 {)
        )
    )
    (class 4 1 class
        (empty 4 7 {)
        (object 4 7 {
            (property 5 9 cat
                (string 5 9 cat)
                (function 5 9 cat
                    (name 5 9 cat
                        (identifier 5 9 cat)
                    )
                    (parameters 5 13 {)
                    (landmark 5 13 {)
                    (scope 5 13 {
                        (return 6 9 return
                            (number 6 16 0)
                        )
                        (return 7 5 }
                            (void 7 5 })
                        )
                    )
                    (landmark 7 5 })
                )
            )
            (property 9 9 dog
                (string 9 9 dog)
                (function 9 9 dog
                    (name 9 9 dog
                        (identifier 9 9 dog)
                    )
                    (parameters 9 12 paren_open)
                    (landmark 9 15 {)
                    (scope 9 15 {
                        (return 10 9 return
                            (number 10 16 1)
                        )
                        (return 11 5 }
                            (void 11 5 })
                        )
                    )
                    (landmark 11 5 })
                )
            )
            (property 13 9 pet
                (string 13 9 pet)
                (function 13 9 pet
                    (name 13 9 pet
                        (identifier 13 9 pet)
                    )
                    (parameters 13 12 paren_open
                        (identifier 13 13 name)
                    )
                    (landmark 13 19 {)
                    (scope 13 19 {
                        (return 14 9 return
                            (operator 14 21 ++
                                (identifier 14 16 name)
                                (string 14 24 "x")
                            )
                        )
                        (return 15 5 }
                            (void 15 5 })
                        )
                    )
                    (landmark 15 5 })
                )
            )
            (property 17 9 parrot
                (string 17 9 parrot)
                (function 17 9 parrot
                    (name 17 9 parrot
                        (identifier 17 9 parrot)
                    )
                    (parameters 17 15 paren_open
                        (identifier 17 16 num_wings)
                        (identifier 17 27 color)
                    )
                    (landmark 17 34 {)
                    (scope 17 34 {
                        (return 18 9 return
                            (operator 18 26 +
                                (identifier 18 16 num_wings)
                                (identifier 18 28 color)
                            )
                        )
                        (return 19 5 }
                            (void 19 5 })
                        )
                    )
                    (landmark 19 5 })
                )
            )
        )
        (constructor 4 1 class
            (name 4 1 class)
            (parameters 4 7 {)
            (landmark 4 7 {)
            (scope 4 7 {
                (return 4 7 {
                    (this 4 7 {)
                )
            )
            (landmark 4 7 {)
        )
    )
    (class 22 1 class
        (empty 22 7 {)
        (object 22 7 {
            (property 23 9 aaa
                (string 23 9 aaa)
                (function 23 9 aaa
                    (name 23 9 aaa
                        (identifier 23 9 aaa)
                    )
                    (parameters 23 13 {)
                    (landmark 23 13 {)
                    (scope 23 13 {
                        (return 23 15 }
                            (void 23 15 })
                        )
                    )
                    (landmark 23 15 })
                )
            )
            (property 27 9 bbb
                (string 27 9 bbb)
                (function 27 9 bbb
                    (name 27 9 bbb
                        (identifier 27 9 bbb)
                    )
                    (parameters 27 13 {)
                    (landmark 27 13 {)
                    (scope 27 13 {
                        (return 27 15 }
                            (void 27 15 })
                        )
                    )
                    (landmark 27 15 })
                )
            )
        )
        (constructor 25 5 constructor
            (name 25 5 constructor)
            (parameters 25 17 {)
            (landmark 25 17 {)
            (scope 25 17 {
                (assignment 25 26 =
                    (left_hand_side 25 26 =
                        (refinement 25 23 .
                            (this 25 19 this)
                            (string 25 24 x)
                        )
                    )
                    (number 25 28 0)
                )
                (return 25 30 }
                    (this 25 30 })
                )
            )
            (landmark 25 30 })
        )
    )
)

@------------------------------------------------------------------------------
class myclass {
    ;
    constructor { };
    ;
    fun somefun { };
    ;
    var number = 42;
    ;
    var lambda = _ => 42;
    ;
}

@0

(scope 1 1
    (assignment 1 1 class
        (const 1 1 class
        (identifier 1 7 myclass))
        (class 1 7 myclass
            (empty 1 15 {)
            (object 1 15 {
                (property 5 9 somefun
                    (string 5 9 somefun)
                    (function 5 9 somefun
                        (name 5 9 somefun
                            (identifier 5 9 somefun))
                        (parameters 5 17 {)
                        (landmark 5 17 {)
                        (scope 5 17 {
                            (return 5 19 }
                                (void 5 19 })))
                        (landmark 5 19 })))
                (property 7 9 number
                    (string 7 9 number)
                    (number 7 18 42))
                (property 9 9 lambda
                    (string 9 9 lambda)
                    (function 9 20 =>
                        (name 9 20 =>)
                        (parameters 9 20 =>
                            (placeholder 9 18 _))
                        (landmark 9 20 =>)
                        (scope 9 20 =>
                            (return 9 20 =>
                                (number 9 23 42)))
                        (landmark 9 25 ;))))
            (constructor 3 5 constructor
                (name_const 3 5 constructor
                    (identifier 1 7 myclass))
                (parameters 3 17 {)
                (landmark 3 17 {)
                (scope 3 17 {
                    (return 3 19 }
                        (this 3 19 })))
                (landmark 3 19 }))))
)

@------------------------------------------------------------------------------
class named {
    constructor(a, b) { this[a] = b }

    fun fun1(a) { return a }

    fun fun2 { return this.a }
}

class onlyctor {
    constructor(x) { this.mmm = x }
}

@ 0

(scope 1 1
    (assignment 1 1 class
        (const 1 1 class
            (identifier 1 7 named)
        )
        (class 1 7 named
            (empty 1 13 {)
            (object 1 13 {
                (property 4 9 fun1
                    (string 4 9 fun1)
                    (function 4 9 fun1
                        (name 4 9 fun1
                            (identifier 4 9 fun1)
                        )
                        (parameters 4 13 paren_open
                            (identifier 4 14 a)
                        )
                        (landmark 4 17 {)
                        (scope 4 17 {
                            (return 4 19 return
                                (identifier 4 26 a)
                            )
                            (return 4 28 }
                                (void 4 28 })
                            )
                        )
                        (landmark 4 28 })
                    )
                )
                (property 6 9 fun2
                    (string 6 9 fun2)
                    (function 6 9 fun2
                        (name 6 9 fun2
                            (identifier 6 9 fun2)
                        )
                        (parameters 6 14 {)
                        (landmark 6 14 {)
                        (scope 6 14 {
                            (return 6 16 return
                                (refinement 6 27 .
                                    (this 6 23 this)
                                    (string 6 28 a)
                                )
                            )
                            (return 6 30 }
                                (void 6 30 })
                            )
                        )
                        (landmark 6 30 })
                    )
                )
            )
            (constructor 2 5 constructor
                (name_const 2 5 constructor
                    (identifier 1 7 named))
                (parameters 2 16 paren_open
                    (identifier 2 17 a)
                    (identifier 2 20 b)
                )
                (landmark 2 23 {)
                (scope 2 23 {
                    (assignment 2 33 =
                        (left_hand_side 2 33 =
                            (refinement 2 29 [
                                (this 2 25 this)
                                (identifier 2 30 a)
                        ))
                        (identifier 2 35 b)
                    )
                    (return 2 37 }
                        (this 2 37 })
                ))
                (landmark 2 37 })
    )))

    (assignment 9 1 class
        (const 9 1 class
            (identifier 9 7 onlyctor)
        )
        (class 9 7 onlyctor
            (empty 9 16 {)
            (object 9 16 {)
            (constructor 10 5 constructor
                (name_const 10 5 constructor
                    (identifier 9 7 onlyctor))
                (parameters 10 16 paren_open
                    (identifier 10 17 x)
                )
                (landmark 10 20 {)
                (scope 10 20 {
                    (assignment 10 31 =
                        (left_hand_side 10 31 =
                            (refinement 10 26 .
                                (this 10 22 this)
                                (string 10 27 mmm)
                        ))
                        (identifier 10 33 x)
                    )
                    (return 10 35 }
                        (this 10 35 })
                ))
                (landmark 10 35 })
    )))
)

@------------------------------------------------------------------------------
class x extends a { }

class y extends a.b { }

@ 0

(scope 1 1
    (assignment 1 1 class
        (const 1 1 class
            (identifier 1 7 x))
        (class 1 7 x
            (identifier 1 17 a)
            (object 1 19 {)
            (constructor 1 7 x
                (name_const 1 7 x
                    (identifier 1 7 x))
                (parameters 1 9 extends
                    (ellipsis 1 9 extends
                        (identifier 1 9 extends)))
                (landmark 1 9 extends)
                (scope 1 9 extends
                    (invocation 1 9 extends
                        (super-ctor 1 9 extends)
                        (expand 1 9 extends
                            (identifier 1 9 extends)))
                    (return 1 9 extends
                        (this 1 9 extends)))
                (landmark 1 9 extends)))
    )
    (assignment 3 1 class
        (const 3 1 class
            (identifier 3 7 y))
        (class 3 7 y
            (refinement 3 18 .
                (identifier 3 17 a)
                (string 3 19 b))
            (object 3 21 {)
            (constructor 3 7 y
                (name_const 3 7 y
                    (identifier 3 7 y))
                (parameters 3 9 extends
                    (ellipsis 3 9 extends
                        (identifier 3 9 extends)))
                (landmark 3 9 extends)
                (scope 3 9 extends
                    (invocation 3 9 extends
                        (super-ctor 3 9 extends)
                        (expand 3 9 extends
                            (identifier 3 9 extends)))
                    (return 3 9 extends
                        (this 3 9 extends)))
                (landmark 3 9 extends)))
    )
)

@------------------------------------------------------------------------------
class extends x {
    constructor {
        super()
        super
    }
    fun super {
        return super
    }
}

@ 0

(scope 1 1
    (class 1 1 class
        (identifier 1 15 x)
        (object 1 17 {
            (property 6 9 super
                (string 6 9 super)
                (function 6 9 super
                    (name 6 9 super
                        (identifier 6 9 super)
                    )
                    (parameters 6 15 {)
                    (landmark 6 15 {)
                    (scope 6 15 {
                        (return 7 9 return
                            (super-proto 7 16 super)
                        )
                        (return 8 5 }
                            (void 8 5 })
                        )
                    )
                    (landmark 8 5 })
                )
            )
        )
        (constructor 2 5 constructor
            (name 2 5 constructor)
            (parameters 2 17 {)
            (landmark 2 17 {)
            (scope 2 17 {                
                (invocation 3 14 paren_open
                    (super-ctor 3 9 super))
                (super-proto 4 9 super)
                (return 5 5 }
                    (this 5 5 })))
            (landmark 5 5 }))
    )
)

@------------------------------------------------------------------------------
# Function named "constructor" is OK
class extends x {
    fun constructor {
        return 42
    }
}

@ 0

(scope 1 1
    (class 2 1 class
        (identifier 2 15 x)
        (object 2 17 {
            (property 3 9 constructor
                (string 3 9 constructor)
                (function 3 9 constructor
                    (name 3 9 constructor
                        (identifier 3 9 constructor)
                    )
                    (parameters 3 21 {)
                    (landmark 3 21 {)
                    (scope 3 21 {
                        (return 4 9 return
                            (number 4 16 42)
                        )
                        (return 5 5 }
                            (void 5 5 })
                        )
                    )
                    (landmark 5 5 })
                )
            )
        )
        (constructor 2 1 class
            (name 2 1 class)
            (parameters 2 7 extends
                (ellipsis 2 7 extends
                    (identifier 2 7 extends)))
            (landmark 2 7 extends)
            (scope 2 7 extends
                (invocation 2 7 extends
                    (super-ctor 2 7 extends)
                    (expand 2 7 extends
                        (identifier 2 7 extends)))
                (return 2 7 extends
                    (this 2 7 extends)
                )
            )
            (landmark 2 7 extends)
        )
    )
)

@------------------------------------------------------------------------------
class banana
{
    var length = 1 + 2
}

@ 0

(scope 1 1
    (assignment 1 1 class
        (const 1 1 class
            (identifier 1 7 banana)
        )
        (class 1 7 banana
            (empty 2 1 {)
            (object 2 1 {
                (property 3 9 length
                    (string 3 9 length)
                    (operator 3 20 +
                        (number 3 18 1)
                        (number 3 22 2)
                    )
                )
            )
            (constructor 1 7 banana
                (name_const 1 7 banana
                    (identifier 1 7 banana)
                )
                (parameters 2 1 {)
                (landmark 2 1 {)
                (scope 2 1 {
                    (return 2 1 {
                        (this 2 1 {)
                    )
                )
                (landmark 2 1 {)
            )
        )
    )
)

@------------------------------------------------------------------------------
class failed
{
    constructor { }
    constructor { } # Duplicate constructor
}

@ 10 4 5

@------------------------------------------------------------------------------
class {
    fun aaa { }

    constructor { this.x = 0 }

    fun bbb { }

    constructor(a) { }
}

@ 10 8 5

@------------------------------------------------------------------------------
const x = class;

@ 10 1 16

@------------------------------------------------------------------------------
const x = class A { }

@ 10 1 17

@------------------------------------------------------------------------------
# Return non-this from constructor
class {
    constructor {
        return void
    }
}

@ 10 4 16

@------------------------------------------------------------------------------
# Yield in constructor
class {
    constructor {
        yield void
    }
}

@ 10 4 9

@------------------------------------------------------------------------------
# Unexpected separator
class { : }

@ 10 2 9

@------------------------------------------------------------------------------
# Invalid extends clause
class x extends a + b { }

@ 10 2 19

@------------------------------------------------------------------------------
# super outside of class
super

@ 10 2 1

@------------------------------------------------------------------------------
# super outside of class
fun x { super }

@ 10 2 9

@------------------------------------------------------------------------------
# super not directly in a class member (is not capturing)
class C extends a {
    fun xyz {
        fun zzz {
            super
        }
    }
}

@ 10 5 13

@------------------------------------------------------------------------------
# super not allowed in arguments
class abc extends a {
    fun xyz(a = super.x) {
    }
}

@ 10 3 17

@------------------------------------------------------------------------------
# super in a non-derived class
class abc {
    fun xyz {
        return super.x
    }
}

@ 10 4 16

@------------------------------------------------------------------------------
# super invocation outside of constructor
class abc extends def {
    fun xyz {
        super()
    }
}

@ 10 4 9

@------------------------------------------------------------------------------
# super invocation outside of constructor (stream operator)
class abc extends def {
    fun xyz(a) {
        a -> super
    }
}

@ 10 4 14

@------------------------------------------------------------------------------
# Missing fun keyword
class abc {
    xyz(a) {
    }
}

@ 10 3 5

@------------------------------------------------------------------------------
# Missing identifier for member var
class some {
    var = 1
}

@ 10 3 9

@------------------------------------------------------------------------------
# Missing '=' for member var
class some {
    var value 1
}

@ 10 3 15

@------------------------------------------------------------------------------
# Invalid member function
class {
    fun {
        {}
    }
}

@ 10 3 9
